<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="kr.ac.ju.dao.DocDao">

	<!-- 직원 로그인 기안서, 휴가계획서, 퇴직서 정보 조회  -->
	<select id="getDocEmployeeByNo" parameterType="int" resultType="hashmap">
		SELECT 
			A.DOC_NO, B.DRAFT_TITLE, 
			A.DOC_FILE_YN, C.EMPLOYEE_NAME, 
			D.PROFESSOR_NAME, 
			A.DOC_CREATE_DATE, 
			A.DOC_STATE
		FROM 
			DOCS A, DRAFTS B, 
			EMPLOYEES C, 
			PROFESSORS D
		WHERE 
			A.DOC_NO = B.DOCS_NO
		AND 
			A.EMPLOYEE_NO = C.EMPLOYEE_NO
		AND 
			A.DOC_FINAL_PERSON = D.PROFESSOR_NO
		AND 
			A.EMPLOYEE_NO = #{value}
		UNION
		SELECT 
			A.DOC_NO, 
			'휴가신청서', 
			A.DOC_FILE_YN, 
			C.EMPLOYEE_NAME, 
			D.PROFESSOR_NAME,  
			A.DOC_CREATE_DATE, 
			A.DOC_STATE
		FROM 
			DOCS A, 
			EMPLOYEES C, 
			PROFESSORS D
		WHERE 
			A.EMPLOYEE_NO = C.EMPLOYEE_NO
		AND 
			A.DOC_FINAL_PERSON = D.PROFESSOR_NO
		AND 
			A.EMPLOYEE_NO = #{value}
		UNION
		SELECT 
			A.DOC_NO, 
			'퇴직신청서', 
			A.DOC_FILE_YN, 
			B.EMPLOYEE_NAME, 
			C.PROFESSOR_NAME, 
			A.DOC_CREATE_DATE, 
			A.DOC_STATE 
		FROM 
			DOCS A, 
			EMPLOYEES B, 
			PROFESSORS C
		WHERE 
			A.EMPLOYEE_NO = B.EMPLOYEE_NO
		AND 
			A.DOC_FINAL_PERSON = C.PROFESSOR_NO
		AND 
			A.EMPLOYEE_NO = #{value}
	</select>
	 
	<!-- SEQ 생성 -->
	<select id="getDocSeq" resultType="int">
		select 
			doc_detail_seq.nextval
		from
			dual
	</select>
	
	<!-- 결재문서등록 Doc -->
	<insert id="insertDoc" parameterType="doc">
		insert into Doc
			(doc_no, 
			employee_no, 
			doc_state, 
			doc_final_person,
			doc_file_yn)
		values
			(#{no},
			 #{employee.no}, 
			 #{state},
			 #{finalPerson},
			 #{fileYn})
	</insert>
	
	
	
	
</mapper>